<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="yanm1ng&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  <title>
    
      做一个Android计算器 | Jngoogle
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/plugins/gitment.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
  <script src="/js/gitment.js"></script>
</head>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>Jngoogle</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>做一个Android计算器</h2>
  <p class="post-date">2016-12-11</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body">
  <article class="post-article">
    <section class="markdown-content"><h2 id="知识点清单"><a href="#知识点清单" class="headerlink" title="知识点清单"></a>知识点清单</h2><ul>
<li>TableLayout 相关知识</li>
<li>AnimationSet 相关知识（简单的动画效果实现）</li>
<li>可选 <a href="https://github.com/JakeWharton/butterknife" target="_blank" rel="external">butterknife</a>（声明 View 控件的另一种方式）</li>
</ul>
<h2 id="核心思路"><a href="#核心思路" class="headerlink" title="核心思路"></a>核心思路</h2><p>通过  <code>后缀表达式</code>  来计算输入的算式，是本程序逻辑的重点。</p>
<p>先来解释一下为什么做一个计算器会用到  <code>后缀表达式</code> 。我们人脑在处理算式的时候是按照  <code>中缀表达式</code>  的方式来处理的。比如：6 - 4  ，我们大脑处理这个算式的顺序很自然的就是6减去4最后得到结果。如果更复杂一些的算式如：6 - 4 x 3 ，我们第一反应是根据运算符的优先级别决定先运算4 x 3 然后再用6减去之前得到的结果。</p>
<p><strong>综上所述，我们人脑在计算算式的时候其实是按照  <code>中缀表达式</code> 的顺序来计算的。</strong>但是如果我们程序采用这种方式来计算算式编写的逻辑会十分的麻烦，所以这里我们就提出来  <code>后缀表达式</code>  来方便程序逻辑的编写，同时也是方便计算机处理。所以在编写的逻辑中我们有着关键一步就是把 <code>中缀表达式</code>  转换成为 <code>后缀表达式</code> 。</p>
<p>好了，我们来从全局整理一下我们编写计算器的逻辑。</p>
<p>1  得到用户输入的算式（此算式为中缀表达式所表示）。</p>
<p>2  将此中缀表达式转化成后缀表达式。</p>
<p>3  计算转化得到的后缀表达式得出算式结果。 </p>
<h2 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h2><p><a href="https://coding.net/u/jammic/p/JCalculator/git" target="_blank" rel="external">项目地址</a></p>
<p>这里只讨论关键思路，详细的代码请查看项目地址中的代码。</p>
<ul>
<li><p><strong>获得用户输入的具体过程</strong></p>
<p><em>按照中缀表达式（即从左到右的顺序把 String 存到栈中）</em></p>
<p>1  用 <code>num</code> 作为一个存放数字或者点号的临时变量。</p>
<p>2  判断当前要存入栈的字符是 运算符 还是 数字或者点号。</p>
<p>3  交替的存入 <code>num</code>  和 运算符。</p>
<p>ps：<code>需要注意的一种情况是。用户输入进来的字符串的第一个字符是 运算符，若为此种情况应当在该字符串的首位添加一个0保证后续计算的正确性！（若没有添加0，在使用后缀表达式计算的时候会由于缺少一个运算数报错）。</code></p>
<blockquote>
<p>举例：用户此时的输入是  -6-2 ， 按照后缀表达式的规则先把该式子写成后缀表达式为 6-2- ，然后按照后缀表达式的计算规则，当读到运算符（第一个减号）的时候，弹出前面入栈的两个元素进行计算，但此时在减号前面入栈的只有6这一个元素无法计算，因此报错。</p>
</blockquote>
</li>
<li><p><strong>把中缀表达式转变成后缀表达式（重点讨论）</strong></p>
<p> 1  建立两个栈， 一个是存放转化成为后缀表达式的栈 A，一个是存放运算符的栈 B。</p>
<p> 2  首先根据上一步，我们已经保证了得到的输入字符串的首位肯定是一个数字。开始进行转化逻辑如下：</p>
<p>​    <em>从左向右依次读取字符串</em></p>
<p>​     2.1  如果是数字或者点号存入到 A  </p>
<p>​     2.2  如果是运算符，一 当 B 栈为空则直接放入 B； 二  B 栈不为空把该栈顶元素与当前得到的元算符进行优先级比较。如果运算符栈顶运算符的优先级大于当前运算符则把栈顶运算符存入到  A  ，把当前运算符存入到 B 中；如果运算符栈顶元素的优先级小于当前元算符，则直接把当前运算符存入到 B 中。</p>
<p>​     2.3  检查 B 栈 ， 如果还有元素存在则都存入  A  中。</p>
</li>
</ul>
<p>​         3  最终得到  A 栈中的结果就是用后缀表达式的方式所表示的字符串。</p>
<blockquote>
<p>举例：中缀表达式为 6-5x4</p>
<p>1  把6放入栈 A 中。</p>
<p>2  把减号放入栈 B 中。</p>
<p>3  5放入栈  A  中。</p>
<p>4   乘号由于比  B  中的减号优先级高则直接放入栈 B 中。（此时是运算符栈顶元素减号优先级小于当前元素乘号的情况）。</p>
<p>5  把4放入栈中</p>
<p>此时两个栈的情况是： A ：654；  B：-X  ；</p>
<p>6  最后把 B 中的元素弹出依次放入 A 中，最终得到的后缀表达式为 654x-</p>
</blockquote>
<p><br></p>
<blockquote>
<p>举例：中缀表达式为6x5-4</p>
<p>1 存入6到 A 栈中。</p>
<p>2  把乘号放入运算符栈 B</p>
<p>3  5存入栈 A 中。</p>
<p>4  减号是当前元素由于元算符 B 栈顶元素是乘号优先级高于减号，所以弹出 B 栈的栈顶元素即乘号放入 A 中，然后把当前元素 减号 再放入 B 中。此时两个栈的情况为： A：65x ； B：-  ；</p>
<p>5  把4放入 A  中。</p>
<p>6  把 B 中所有的元素（若有）放入 A 中，即把减号放入 A 中。最终得到的后缀表达式为 65X4-</p>
</blockquote>
<ul>
<li><p><strong>计算后缀表达式</strong></p>
<p><em>从左至右依次读取由后缀表达式表示的字符串</em></p>
<p>1  如果读到当前字符是数字或者点号则存入栈中。</p>
<p>2  如果读到运算符则把栈顶的两个元素弹出来然后用该运算符对其计算，所得到的结果再存入栈中。</p>
</li>
</ul>
<hr>
<p>以上就是整个计算器实现的关键思路了，详细的代码可以去<a href="https://coding.net/u/jammic/p/JCalculator/git" target="_blank" rel="external">项目</a>查看。如果你有什么问题可以在项目中 <code>讨论</code>  中交流。</p>
<p>对了对了，最后如果你也喜爱二次元或者喜爱翻唱欢迎来加微博，在博客的左边。</p>
</section>
    
      <div class="tags">
        <span>Tags:</span>
        
  <span class="tag-code">Android</span>

      </div>
    
    <div class="money-like">
      <div class="reward-btn">
        赏
        <span class="money-code">
          <span class="alipay-code">
            <div class="code-image"></div>
            <b>使用支付宝打赏</b>
          </span>
          <span class="wechat-code">
            <div class="code-image"></div>
            <b>使用微信打赏</b>
          </span>
        </span>
      </div>
      <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
    </div>
    <div class="qrcode">
      <canvas id="share-qrcode"></canvas>
      <p class="notice">扫描二维码，分享此文章</p>
    </div>
    <div id="comments"></div>
  </article>
</main>

<script>
  (function () {
    var url = 'https://jngoogle.github.io/2016/12/11/做一个Android计算器，我学到了什么/';
    $('#article-banner').geopattern(url)
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://yanm1ng.cn/error-img.png') 
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "jngoogle";
    if (gitmentConfig != "undefined") {
      var gitment = new Gitment({
        owner: "jngoogle",
        repo: "jngoogle.github.io",
        oauth: {
          client_id: "a7daaa9ef8e1113741c6",
          client_secret: "fed19c22a2cd3f1ee7f737a42d5cb2630114d1ba"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2017 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>
<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine == 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>